---
import MainLayout from '../../layouts/MainLayout.astro';
import { getTimelineData } from '../../utils/resume-parser';

const title = 'Career Timeline | Noah Cantor';
const description = 'Explore Noah Cantor\'s professional journey and career path through an interactive timeline';

// Get the timeline data for initial render (English by default)
const timelineData = getTimelineData('en');
const jsonData = JSON.stringify({
  title: timelineData.title,
  events: timelineData.events
});
---

<MainLayout title={title} description={description}>
  <section class="py-12 md:py-16 px-4">
    <div class="container mx-auto max-w-5xl">
      <div class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-bold mb-6">
          <span class="lang-en">My Professional Journey</span>
          <span class="lang-es hidden">Mi Trayectoria Profesional</span>
        </h1>
        <p class="text-lg max-w-2xl mx-auto mb-8 lang-en">
          Explore my career path and professional experiences through this interactive timeline.
        </p>
        <p class="text-lg max-w-2xl mx-auto mb-8 lang-es hidden">
          Explora mi trayectoria profesional y experiencias a través de esta línea de tiempo interactiva.
        </p>
      </div>
      
      <!-- Timeline container -->
      <div id="timeline-embed" class="w-full h-[600px] mb-10 rounded-lg overflow-hidden shadow-lg"></div>
      
      <div class="text-center mt-10">
        <a href="/static/NoahCantorResume.pdf" class="primary-btn inline-flex items-center" target="_blank">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <span class="lang-en">Download Full Resume</span>
          <span class="lang-es hidden">Descargar CV Completo</span>
        </a>
      </div>
    </div>
  </section>
  
  <!-- Timeline JS library and initialization -->
  <link title="timeline-styles" rel="stylesheet" href="https://cdn.knightlab.com/libs/timeline3/latest/css/timeline.css">
  <script src="https://cdn.knightlab.com/libs/timeline3/latest/js/timeline.js"></script>
  
  <script define:vars={{ jsonData }}>
    // Initialize timeline on page load
    document.addEventListener('DOMContentLoaded', () => {
      initializeTimeline(jsonData);
    });

    // Listen for language changes
    window.addEventListener('languageChange', (e) => {
      fetchTimelineData(e.detail.language);
    });

    // Initialize the timeline with the provided data
    function initializeTimeline(data) {
      const timelineData = typeof data === 'string' ? JSON.parse(data) : data;
      
      new TL.Timeline('timeline-embed', timelineData, {
        start_at_end: false,
        default_bg_color: { r: 255, g: 122, b: 0 },
        scale_factor: 1,
        language: document.documentElement.lang
      });
    }

    // Fetch timeline data for the specified language
    async function fetchTimelineData(language) {
      try {
        const response = await fetch(`/api/timeline.json?lang=${language}`);
        const data = await response.json();
        initializeTimeline(data);
      } catch (error) {
        console.error('Failed to fetch timeline data:', error);
      }
    }
  </script>
</MainLayout>
